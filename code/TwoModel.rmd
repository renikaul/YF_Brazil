---
title: "TwoModelVariableSelection"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load packages}
#load packages
library(dplyr)
library(gplots)
library(parallel)
library(doParallel)
library(ROCR)
library(pROC)

#source functions
source("functions/baggingWperm.R")

#Return AUC Quick
RankImp=function(x){
PermSFAUC <- x[[2]]
PermSFAUC[,2] <- round(as.numeric(as.character(PermSFAUC[,2])),digits=3)
PermSFAUC[,3] <- round(as.numeric(as.character(PermSFAUC[,3])),digits=3)
return(PermSFAUC[order(PermSFAUC$meanAUC),])}

#load data
## High NHP
Htraining.data <- readRDS("../data_clean/TrainingDataHighNHP.rds")
## Low NHP
Ltraining.data <- readRDS("../data_clean/TrainingDataLowNHP.rds")
```

# Full Model



```{r Kitchen sink}
glm.formula <- as.formula("case~  NDVI+NDVIScale+
                          popLog10+
                          RF+RFsqrt+RFScale+
                          tempMean+tempScale+
                          fireDenSqrt+fireDenScale+
                          spRich+primProp") 

## High NHP
#load data
Htraining.data <- readRDS("../data_clean/TrainingDataHighNHP.rds")
HPermFullModel <- permOneVar(formula = glm.formula,traindata = Htraining.data, cores = 10, no.iterations = 500, perm = 10, viz = FALSE)
saveRDS(HPermFullModel, "../data_out/TwoModelSoln/HPermFullModel.rds")

## Low NHP
#load data
Ltraining.data <- readRDS("../data_clean/TrainingDataLowNHP.rds")
LPermFullModel <- permOneVar(formula = glm.formula,traindata = Ltraining.data, cores = 10, no.iterations = 500, perm = 10, viz = FALSE)
saveRDS(LPermFullModel, "../data_out/TwoModelSoln/LPermFullModel.rds")
```

```{r kitchen sink predictions}

hPredFull <-  BaggedModeles(form.x.y = glm.formula, training = Htraining.data, new.data = Htraining.data, no.iterations = 500)
lPredFull <-  BaggedModeles(form.x.y = glm.formula, training = Ltraining.data, new.data = Ltraining.data, no.iterations = 500)

save(hPredFull,lPredFull, file = "../data_out/Predictions/TwoModel/fullPredictions.RData")


```

# Popless 
```{r drop Pop}
#drop one covar importance
glm.formula.popless <- as.formula("case~  NDVI+NDVIScale+ 
                          RFsqrt+RFScale+
                          tempMean+tempScale+
                          fireDenSqrt+fireDenScale+
                          spRich+primProp") 

PoplessVariables <- trimws(unlist(strsplit(as.character(glm.formula.popless)[3], "+", fixed = T)), which = "both")

#High NHP
HPermPoplessModel <- permOneVar(formula = glm.formula.popless,traindata = Htraining.data, cores=10, no.iterations = 500, perm = 10, title="High" ) 
saveRDS(HPermPoplessModel, "../data_out/TwoModelSoln/HPermPoplessModel.rds")


#Low NHP

Sys.time()
LPermPoplessModel <- permOneVar(formula = glm.formula.popless,traindata = Ltraining.data, cores=10, no.iterations = 500, perm = 10 , title="Low")
Sys.time()
saveRDS(LPermPoplessModel, "../data_out/TwoModelSoln/LPermPoplessModel.rds")


```

```{r popless predictions}


hPredPopless <-  BaggedModeles(form.x.y = glm.formula.popless, training = Htraining.data, new.data = Htraining.data, no.iterations = 500)
lPredPopless <-  BaggedModeles(form.x.y = glm.formula.popless, training = Ltraining.data, new.data = Ltraining.data, no.iterations = 500)

save(hPredPopless,lPredPopless, file = "../data_out/Predictions/TwoModel/poplessPredictions.RData")

```

